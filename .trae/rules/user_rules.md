# STT 프로젝트 사용자 규칙 (User Rules)

## 📋 목차
1. [개발 환경 규칙](#개발-환경-규칙)
2. [코드 작성 규칙](#코드-작성-규칙)
3. [데이터베이스 규칙](#데이터베이스-규칙)
4. [API 설계 규칙](#api-설계-규칙)
5. [보안 규칙](#보안-규칙)
6. [로깅 및 모니터링 규칙](#로깅-및-모니터링-규칙)
7. [테스트 규칙](#테스트-규칙)
8. [배포 및 운영 규칙](#배포-및-운영-규칙)
9. [문서화 규칙](#문서화-규칙)
10. [성능 및 최적화 규칙](#성능-및-최적화-규칙)

---

## 🛠️ 개발 환경 규칙

### 1.1 프로젝트 구조
- **백엔드**: `backend/` 디렉토리에 FastAPI 기반 서버 코드
- **프론트엔드**: `frontend/` 디렉토리에 Vue.js 기반 클라이언트 코드
- **환경 설정**: `.env` 파일을 사용하여 환경별 설정 관리
- **의존성 관리**: `requirements.txt`로 Python 패키지 관리

### 1.2 환경 변수 관리
- 모든 민감한 정보는 `.env` 파일에 저장
- `.env.example` 파일로 필수 환경 변수 템플릿 제공
- 프로덕션 환경에서는 환경 변수로 직접 설정

### 1.3 버전 관리
- Git을 사용한 소스 코드 관리
- 브랜치 전략: `main` (프로덕션), `develop` (개발), `feature/*` (기능 개발)
- 커밋 메시지는 한국어로 명확하게 작성

---

## 💻 코드 작성 규칙

### 2.1 Python 코딩 스타일
- PEP 8 스타일 가이드 준수
- 함수와 클래스에 한국어 docstring 작성
- 변수명과 함수명은 영어로, 주석은 한국어로 작성
- 타입 힌트 사용 권장 (`typing` 모듈 활용)

### 2.2 FastAPI 개발 규칙
- 모든 엔드포인트에 `summary`와 상세 docstring 작성
- Pydantic 모델을 사용한 요청/응답 검증
- 의존성 주입(Dependency Injection) 패턴 활용
- 비동기 처리가 필요한 경우 `async/await` 사용

### 2.3 에러 처리
- 모든 예외는 적절한 HTTP 상태 코드와 함께 처리
- 사용자 친화적인 한국어 에러 메시지 제공
- 로깅을 통한 에러 추적 및 디버깅 정보 기록

---

## 🗄️ 데이터베이스 규칙

### 3.1 스키마 설계
- PostgreSQL을 기본 데이터베이스로 사용
- SQLAlchemy ORM을 통한 데이터베이스 접근
- 모든 테이블과 컬럼에 한국어 주석 작성
- UUID 사용으로 보안성 강화 (`user_uuid` 필드)

### 3.2 테이블 명명 규칙
- 테이블명: 복수형 snake_case (예: `transcription_requests`)
- 컬럼명: snake_case (예: `created_at`, `user_uuid`)
- 인덱스명: `idx_테이블명_컬럼명` 형식

### 3.3 데이터 무결성
- 필수 필드는 `nullable=False` 설정
- 외래 키 관계 명확히 정의
- 적절한 인덱스 설정으로 성능 최적화
- 타임스탬프 필드는 timezone 정보 포함

### 3.4 마이그레이션 관리
- Alembic을 사용한 데이터베이스 스키마 버전 관리
- 모든 스키마 변경은 마이그레이션 스크립트로 관리
- `migration/` 디렉토리에 관련 스크립트 저장

---

## 🔌 API 설계 규칙

### 4.1 RESTful API 설계
- HTTP 메소드 적절히 활용 (GET, POST, PUT, DELETE)
- 리소스 중심의 URL 설계
- 일관된 응답 형식 유지

### 4.2 엔드포인트 명명 규칙
- URL은 소문자와 하이픈 사용
- 복수형 명사 사용 (예: `/users/`, `/transcriptions/`)
- 버전 관리 고려 (필요시 `/v1/` 접두사)

### 4.3 응답 형식
- JSON 형식으로 응답
- 성공/실패 상태 명확히 구분
- 에러 응답에는 상세한 메시지 포함
- 페이지네이션 지원 (`limit` 파라미터)

### 4.4 STT 서비스 통합
- 다중 STT 서비스 지원 (AssemblyAI, Daglo)
- 폴백 메커니즘으로 서비스 안정성 확보
- 서비스별 설정과 응답 형식 표준화

---

## 🔒 보안 규칙

### 5.1 인증 및 권한 관리
- JWT 토큰 기반 사용자 인증
- API 키를 통한 서비스 접근 제어
- 패스워드는 bcrypt로 해시화하여 저장
- 토큰 만료 시간 설정 (기본 24시간)

### 5.2 API 키 관리
- 사용자별 다중 API 키 지원
- API 키는 해시화하여 데이터베이스 저장
- 토큰 활성화/비활성화 기능
- 사용 이력 추적 및 모니터링

### 5.3 데이터 보호
- 민감한 정보는 환경 변수로 관리
- SQL 인젝션 방지 (ORM 사용)
- 입력 데이터 검증 및 sanitization
- HTTPS 사용 권장

### 5.4 접근 로깅
- 모든 로그인 시도 기록 (`login_logs` 테이블)
- API 사용 로그 기록 (`api_usage_logs` 테이블)
- IP 주소 및 User-Agent 정보 저장
- 실패한 인증 시도 모니터링

---

## 📊 로깅 및 모니터링 규칙

### 6.1 로깅 시스템
- Python `logging` 모듈 사용
- 로그 레벨: DEBUG, INFO, WARNING, ERROR, CRITICAL
- 파일 로테이션 설정 (크기 및 시간 기반)
- 구조화된 로그 메시지 (타임스탬프, 레벨, 메시지)

### 6.2 로그 내용
- API 요청/응답 로깅
- STT 서비스 처리 시간 기록
- 에러 발생 시 상세 스택 트레이스
- 사용자 행동 패턴 분석을 위한 로그

### 6.3 성능 모니터링
- 요청 처리 시간 측정
- 데이터베이스 쿼리 성능 모니터링
- STT 서비스별 응답 시간 비교
- 시스템 리소스 사용량 추적

---

## 🧪 테스트 규칙

### 7.1 테스트 구조
- `test/` 디렉토리에 테스트 코드 구성
- pytest 프레임워크 사용
- 단위 테스트, 통합 테스트, E2E 테스트 구분

### 7.2 테스트 커버리지
- 핵심 비즈니스 로직 100% 커버리지 목표
- API 엔드포인트 테스트 필수
- 데이터베이스 연동 테스트
- STT 서비스 모킹 테스트

### 7.3 테스트 데이터
- 실제 음성 파일을 사용한 통합 테스트
- 다양한 파일 형식 지원 테스트
- 에러 시나리오 테스트

---

## 🚀 배포 및 운영 규칙

### 8.1 환경 구성
- 개발(Development), 스테이징(Staging), 프로덕션(Production) 환경 분리
- 환경별 설정 파일 관리
- 컨테이너화 고려 (Docker)

### 8.2 서버 설정
- uvicorn ASGI 서버 사용
- 프로덕션에서는 Gunicorn + uvicorn workers 권장
- 리버스 프록시 설정 (Nginx)
- SSL/TLS 인증서 설정

### 8.3 데이터베이스 운영
- 정기적인 백업 수행
- 인덱스 최적화
- 로그 테이블 정리 정책
- 성능 모니터링 및 튜닝

---

## 📚 문서화 규칙

### 9.1 API 문서화
- FastAPI 자동 생성 문서 활용 (Swagger UI)
- 모든 엔드포인트에 상세 설명 작성
- 요청/응답 예시 제공
- 에러 코드 및 메시지 문서화

### 9.2 코드 문서화
- 모든 함수와 클래스에 docstring 작성
- 복잡한 로직에는 인라인 주석 추가
- README.md 파일로 프로젝트 개요 제공
- 설치 및 실행 가이드 작성

### 9.3 데이터베이스 문서화
- 테이블 스키마 다이어그램
- 컬럼별 상세 설명
- 관계 정의 및 제약 조건
- 마이그레이션 히스토리

---

## ⚡ 성능 및 최적화 규칙

### 10.1 응답 시간 최적화
- STT 서비스 응답 시간 모니터링
- 데이터베이스 쿼리 최적화
- 적절한 인덱스 설정
- 캐싱 전략 고려

### 10.2 리소스 관리
- 파일 업로드 크기 제한
- 메모리 사용량 모니터링
- 동시 요청 처리 제한
- 타임아웃 설정

### 10.3 확장성 고려
- 마이크로서비스 아키텍처 고려
- 로드 밸런싱 준비
- 데이터베이스 샤딩 계획
- CDN 활용 검토

---

## 📝 추가 고려사항

### 규칙 준수 체크리스트
- [ ] 환경 변수 설정 확인
- [ ] 데이터베이스 마이그레이션 실행
- [ ] API 문서 업데이트
- [ ] 테스트 코드 작성
- [ ] 로깅 설정 확인
- [ ] 보안 검토 완료
- [ ] 성능 테스트 수행
- [ ] 문서화 완료

### 규칙 위반 시 대응
1. 코드 리뷰를 통한 사전 방지
2. 자동화된 테스트로 품질 보장
3. 지속적인 모니터링 및 개선
4. 팀 내 규칙 공유 및 교육

---

**마지막 업데이트**: 2024년 12월
**작성자**: STT 프로젝트 개발팀
**버전**: 1.0